serverFiles:
  prometheus.yml:
    scrape_configs:
      - job_name: 'tetragon'
        kubernetes_sd_configs:
          - role: service
        relabel_configs:
          - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name]
            action: keep
            regex: tetragon;tetragon

      - job_name: 'tetragon-operator'
        kubernetes_sd_configs:
          - role: service
        relabel_configs:
          - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name]
            action: keep
            regex: tetragon;tetragon-operator-metrics

  alerts:  
    groups:
      - name: security.rules
        rules:
          - alert: SuspiciousProcessExec
            expr: tetragon_process_exec_total{arguments=~".*/etc/shadow.*"} > 0
            for: 1m
            labels:
              severity: critical
            annotations:
              description: "Suspicious process detected in {{ $labels.pod }}"